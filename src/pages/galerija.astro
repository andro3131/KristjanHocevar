---
import Layout from "../layouts/Layout.astro";
import { allImages } from "../data/gallery";
---

<Layout title="Galerija | Kristjan Hočevar" description="Galerija fotografij - Kristjan Hočevar, kantavtor.">
  <!-- Navbar za podstran -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-bg/90 backdrop-blur-md shadow-lg transition-all duration-300">
    <div class="max-w-none mx-0 px-6 md:px-16 lg:px-24 py-4 flex items-center justify-between">
      <a href="/" class="block hover:opacity-80 transition-opacity">
        <img
          src="https://res.cloudinary.com/dewf3zos0/image/upload/w_400,q_auto,f_auto/v1771235412/logo-KH2_cilrlb.png"
          alt="Kristjan Hočevar"
          class="h-12 md:h-14 w-auto"
        />
      </a>
      <a
        href="/"
        class="inline-flex items-center gap-2 text-sm tracking-widest uppercase text-text/80 hover:text-accent transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        Nazaj
      </a>
    </div>
  </nav>

  <main class="pt-28 pb-24">
    <div class="max-w-6xl mx-auto px-6">
      <!-- Naslov -->
      <div class="text-center mb-16 fade-in">
        <p class="text-accent tracking-[0.3em] uppercase text-sm mb-3 font-semibold">
          Galerija
        </p>
        <h1 class="reveal-text font-serif text-4xl md:text-5xl font-bold" data-reveal>
          <span class="word"><span class="word-inner">Vsi</span></span>
          <span class="word"><span class="word-inner" style="transition-delay: 0.1s">trenutki</span></span>
        </h1>
      </div>

      <!-- Grid -->
      <div class="columns-1 sm:columns-2 lg:columns-3 gap-4 space-y-4">
        {
          allImages.map((image, i) => (
            <div
              class="stagger-item break-inside-avoid"
              data-stagger
              style={`transition-delay: ${i * 0.08}s`}
            >
              <div
                class="group relative overflow-hidden rounded-sm cursor-pointer"
                data-gallery-open
                data-gallery-index={i}
              >
                <img
                  src={image.src}
                  alt={image.alt}
                  class="w-full block transition-transform duration-700 group-hover:scale-105"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-bg/0 group-hover:bg-bg/20 transition-colors duration-500" />
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </main>

  <!-- Lightbox -->
  <div
    id="gallery-lightbox"
    class="fixed inset-0 z-[100] pointer-events-none opacity-0 transition-opacity duration-300"
  >
    <div id="gallery-lightbox-backdrop" class="absolute inset-0 bg-bg/95 backdrop-blur-sm"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4 md:p-8">
      <button
        id="gallery-lightbox-close"
        class="absolute top-4 right-4 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-bg/50 text-text/70 hover:text-text hover:bg-bg/80 transition-colors"
        aria-label="Zapri"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <button
        id="gallery-lightbox-prev"
        class="absolute left-3 md:left-6 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-bg/50 text-text/70 hover:text-text hover:bg-bg/80 transition-colors"
        aria-label="Prejšnja"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <img
        id="gallery-lightbox-img"
        src=""
        alt=""
        class="max-w-full max-h-[85vh] object-contain rounded-sm transform scale-95 transition-transform duration-300"
      />

      <button
        id="gallery-lightbox-next"
        class="absolute right-3 md:right-6 z-10 w-10 h-10 flex items-center justify-center rounded-full bg-bg/50 text-text/70 hover:text-text hover:bg-bg/80 transition-colors"
        aria-label="Naslednja"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>

  <script define:vars={{ images: allImages }}>
    const lightbox = document.getElementById("gallery-lightbox");
    const lightboxImg = document.getElementById("gallery-lightbox-img");
    const lightboxClose = document.getElementById("gallery-lightbox-close");
    const lightboxBackdrop = document.getElementById("gallery-lightbox-backdrop");
    const lightboxPrev = document.getElementById("gallery-lightbox-prev");
    const lightboxNext = document.getElementById("gallery-lightbox-next");
    let currentIndex = 0;

    function openLightbox(index) {
      currentIndex = index;
      lightboxImg.src = images[index].src.replace("w_800", "w_1400");
      lightboxImg.alt = images[index].alt;
      lightbox.classList.remove("pointer-events-none", "opacity-0");
      lightbox.classList.add("pointer-events-auto", "opacity-100");
      lightboxImg.classList.remove("scale-95");
      lightboxImg.classList.add("scale-100");
      document.body.style.overflow = "hidden";
    }

    function closeLightbox() {
      lightbox.classList.add("opacity-0");
      lightbox.classList.remove("opacity-100");
      lightboxImg.classList.add("scale-95");
      lightboxImg.classList.remove("scale-100");
      document.body.style.overflow = "";
      setTimeout(() => {
        lightbox.classList.add("pointer-events-none");
        lightbox.classList.remove("pointer-events-auto");
      }, 300);
    }

    function navigate(dir) {
      currentIndex = (currentIndex + dir + images.length) % images.length;
      lightboxImg.src = images[currentIndex].src.replace("w_800", "w_1400");
      lightboxImg.alt = images[currentIndex].alt;
    }

    document.querySelectorAll("[data-gallery-open]").forEach((el) => {
      el.addEventListener("click", () => {
        const index = parseInt(el.dataset.galleryIndex);
        openLightbox(index);
      });
    });

    lightboxClose.addEventListener("click", closeLightbox);
    lightboxBackdrop.addEventListener("click", closeLightbox);
    lightboxPrev.addEventListener("click", () => navigate(-1));
    lightboxNext.addEventListener("click", () => navigate(1));

    document.addEventListener("keydown", (e) => {
      if (!lightbox.classList.contains("opacity-100")) return;
      if (e.key === "Escape") closeLightbox();
      if (e.key === "ArrowLeft") navigate(-1);
      if (e.key === "ArrowRight") navigate(1);
    });
  </script>
</Layout>
